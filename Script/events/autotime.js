const moment = require("moment-timezone");

module.exports.config = {
  name: "autotimer",
  version: "3.3",
  role: 0,
  author: "MOHAMMAD AKASH",
  description: "â° à¦ªà§à¦°à¦¤à¦¿ à¦˜à¦£à§à¦Ÿà¦¾à§Ÿ à¦¸à¦¬ à¦—à§à¦°à§à¦ªà§‡ à¦¹à§‡à¦¡à¦¾à¦°à¦¸à¦¹ à¦…à¦Ÿà§‹ à¦®à§‡à¦¸à§‡à¦œ à¦ªà¦¾à¦ à¦¾à¦¬à§‡ (24-hour system)",
  category: "AutoTime",
  countDown: 3,
};

module.exports.onLoad = async function ({ api }) {

  // â³ à¦¬à¦Ÿ à¦²à§‹à¦¡ à¦¹à¦¤à§‡ à§« à¦¸à§‡à¦•à§‡à¦¨à§à¦¡ à¦…à¦ªà§‡à¦•à§à¦·à¦¾ à¦•à¦°à¦¬à§‡
  setTimeout(async () => {

    const timerData = {
      "12:00:00 AM": "ðŸŒ™ à¦®à¦§à§à¦¯à¦°à¦¾à¦¤! à¦˜à§à¦®à¦¾à¦“, à¦•à¦¾à¦²à¦•à§‡à¦° à¦¦à¦¿à¦¨ à¦¨à¦¤à§à¦¨ à¦†à¦¶à¦¾à§Ÿ à¦¶à§à¦°à§ à¦•à¦°à§‹ ðŸ˜´",
      "01:00:00 AM": "ðŸŒŒ à¦°à¦¾à¦¤ à¦—à¦­à§€à¦°! à¦à¦•à¦Ÿà§ à¦¬à¦¿à¦¶à§à¦°à¦¾à¦® à¦¨à¦¾à¦“ ðŸ’¤",
      "02:00:00 AM": "ðŸŒ  à¦à¦–à¦¨à§‹ à¦œà§‡à¦—à§‡ à¦†à¦›à§‹? à¦šà§‹à¦–à¦Ÿà¦¾ à¦¬à¦¨à§à¦§ à¦•à¦°à§‹ ðŸ˜ª",
      "03:00:00 AM": "ðŸŒƒ à¦°à¦¾à¦¤ à¦ªà§à¦°à¦¾à¦¯à¦¼ à¦¶à§‡à¦·, à¦˜à§à¦®à¦¾à¦“ à¦¬à¦¨à§à¦§à§ ðŸ˜´",
      "04:00:00 AM": "ðŸŒ„ à¦­à§‹à¦° à¦¹à¦¤à§‡ à¦¯à¦¾à¦šà§à¦›à§‡, à¦¨à¦¤à§à¦¨ à¦†à¦²à§‹ à¦†à¦¸à¦›à§‡ ðŸŒ¤ï¸",
      "05:00:00 AM": "ðŸŒ… à¦¶à§à¦­ à¦¸à¦•à¦¾à¦²! à¦¹à¦¾à¦¸à¦¿à¦®à§à¦–à§‡ à¦¦à¦¿à¦¨ à¦¶à§à¦°à§ à¦•à¦°à§‹ â˜€ï¸",
      "06:00:00 AM": "ðŸŒž à¦¸à¦•à¦¾à¦² à¦¬à§‡à¦²à¦¾! à¦à¦• à¦•à¦¾à¦ª à¦šà¦¾ à¦•à¦«à¦¿ à¦•à§‡à¦®à¦¨ à¦¹à¦¬à§‡ â˜•",
      "07:00:00 AM": "ðŸž à¦¨à¦¾à¦¸à§à¦¤à¦¾à¦° à¦¸à¦®à¦¯à¦¼! à¦¶à¦°à§€à¦° à¦­à¦¾à¦²à§‹ à¦°à¦¾à¦–à§‹ ðŸ’ª",
      "08:00:00 AM": "ðŸŒ¤ï¸ à¦¨à¦¤à§à¦¨ à¦¦à¦¿à¦¨à§‡à¦° à¦¬à§à¦¯à¦¸à§à¦¤à¦¤à¦¾ à¦¶à§à¦°à§! à¦¸à¦«à¦² à¦¹à¦“ âœ¨",
      "09:00:00 AM": "ðŸ•˜ à¦¶à§à¦­ à¦¸à¦•à¦¾à¦²! à¦•à¦¾à¦œà§‡ à¦®à¦¨ à¦¦à¦¾à¦“ ðŸ’¼",
      "10:00:00 AM": "ðŸŒž à¦¸à¦•à¦¾à¦²à§‡à¦° à¦¸à§‚à¦°à§à¦¯ à¦¤à§‹à¦®à¦¾à¦° à¦œà¦¨à§à¦¯ à¦¶à¦•à§à¦¤à¦¿ à¦†à¦¨à§à¦• â˜€ï¸",
      "11:00:00 AM": "ðŸŒ» à¦¸à¦•à¦¾à¦² à¦¶à§‡à¦·! à¦à¦•à¦Ÿà§ à¦¬à¦¿à¦¶à§à¦°à¦¾à¦® à¦¨à¦¾à¦“ ðŸ˜Œ",
      "12:00:00 PM": "ðŸ› à¦¦à§à¦ªà§à¦°à§‡à¦° à¦–à¦¾à¦¬à¦¾à¦° à¦¸à¦®à§Ÿ! à¦–à§‡à§Ÿà§‡ à¦¨à¦¾à¦“ ðŸ˜‹",
      "01:00:00 PM": "ðŸ˜´ à¦à¦•à¦Ÿà§ à¦¬à¦¿à¦¶à§à¦°à¦¾à¦® à¦¨à¦¾à¦“, à¦¦à§à¦ªà§à¦°à§‡à¦° à¦˜à§à¦® à¦­à¦¾à¦²à§‹ à¦œà¦¿à¦¨à¦¿à¦¸ ðŸ’¤",
      "02:00:00 PM": "ðŸŒ¤ï¸ à¦¬à¦¿à¦•à§‡à¦² à¦†à¦¸à¦›à§‡! à¦®à¦¨ à¦­à¦¾à¦²à§‹ à¦°à¦¾à¦–à§‹ â˜€ï¸",
      "03:00:00 PM": "â˜€ï¸ à¦¬à¦¿à¦•à§‡à¦²à§‡à¦° à¦°à§‹à¦¦à§‡ à¦¹à¦¾à¦¸à¦¿ à¦›à§œà¦¾à¦“ ðŸ’›",
      "04:00:00 PM": "ðŸŒ‡ à¦¬à¦¿à¦•à§‡à¦² à¦¶à§‡à¦·! à¦à¦•à¦Ÿà§ à¦¶à¦¾à¦¨à§à¦¤à¦¿ à¦¨à¦¾à¦“ â˜•",
      "05:00:00 PM": "ðŸŒ† à¦¸à¦¨à§à¦§à§à¦¯à¦¾ à¦¨à¦¾à¦®à¦›à§‡! à¦¦à¦¿à¦¨à¦Ÿà¦¾ à¦•à§‡à¦®à¦¨ à¦•à¦¾à¦Ÿà¦²à§‹? ðŸ˜Š",
      "06:00:00 PM": "ðŸŒ‡ à¦¶à§à¦­ à¦¸à¦¨à§à¦§à§à¦¯à¦¾! à¦à¦•à¦Ÿà§ à¦¸à¦®à§Ÿ à¦¨à¦¿à¦œà§‡à¦° à¦œà¦¨à§à¦¯ à¦°à¦¾à¦–à§‹ âœ¨",
      "07:00:00 PM": "ðŸŒƒ à¦°à¦¾à¦¤ à¦¨à¦¾à¦®à¦›à§‡, à¦®à¦¨à¦Ÿà¦¾ à¦¶à¦¾à¦¨à§à¦¤ à¦•à¦°à§‹ ðŸ’«",
      "08:00:00 PM": "ðŸ½ï¸ à¦°à¦¾à¦¤à§‡à¦° à¦–à¦¾à¦¬à¦¾à¦° à¦¸à¦®à§Ÿ ðŸ˜‹",
      "09:00:00 PM": "ðŸŒ™ à¦°à¦¾à¦¤ à¦—à¦­à§€à¦° à¦¹à¦šà§à¦›à§‡! à¦¬à¦¿à¦¶à§à¦°à¦¾à¦® à¦¨à¦¾à¦“ ðŸ›Œ",
      "10:00:00 PM": "ðŸ˜´ à¦¶à§à¦­ à¦°à¦¾à¦¤à§à¦°à¦¿! à¦®à¦¿à¦·à§à¦Ÿà¦¿ à¦˜à§à¦®à§‡ à¦šà§‹à¦– à¦¬à§à¦œà§‡ à¦«à§‡à¦²à§‹ ðŸŒ ",
      "11:00:00 PM": "ðŸŒŒ à¦¦à¦¿à¦¨ à¦¶à§‡à¦·! à¦˜à§à¦®à¦¾à¦¨à§‹à¦° à¦ªà§à¦°à¦¸à§à¦¤à§à¦¤à¦¿ à¦¨à¦¾à¦“ ðŸ’¤"
    };

    console.log("âœ… AutoTimer System Loaded â€” à¦ªà§à¦°à¦¤à¦¿ à¦˜à¦£à§à¦Ÿà¦¾à§Ÿ à¦¸à¦®à§Ÿ à¦šà§‡à¦• à¦¶à§à¦°à§ à¦¹à§Ÿà§‡à¦›à§‡...");

    const checkTimeAndSend = async () => {
      const now = moment().tz("Asia/Dhaka").format("hh:mm:ss A");
      const messageText = timerData[now];

      if (messageText) {
        const timeFormatted = moment().tz("Asia/Dhaka").format("hh:mm A");
        const todayDate = moment().tz("Asia/Dhaka").format("DD-MM-YYYY");
        const hour = parseInt(moment().tz("Asia/Dhaka").format("HH"));
        let period = "";

        if (hour >= 4 && hour < 12) period = "à¦¸à¦•à¦¾à¦²";
        else if (hour >= 12 && hour < 17) period = "à¦¦à§à¦ªà§à¦°";
        else if (hour >= 17 && hour < 20) period = "à¦¬à¦¿à¦•à§‡à¦²";
        else if (hour >= 20 && hour < 24) period = "à¦°à¦¾à¦¤";
        else period = "à¦­à§‹à¦°";

        const finalMessage =
`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ðŸ•’ à¦à¦–à¦¨ à¦¸à¦®à§Ÿ: ${period} ${timeFormatted}  
${messageText}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ðŸ“… DATE : ${todayDate}
ðŸ¤– ð™±ðš˜ðš ð™¾ðš ðš—ðšŽðš› : :ðŸ†ƒðŸ…°ðŸ…¼ðŸ…¸ðŸ…¼â€‹ðŸ‡§â€‹â€‹ðŸ‡§â€‹â€‹ðŸ‡¿â€‹
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`;

        try {
          const allThreads = await api.getThreadList(100, null, ["INBOX"]);
          const groupThreads = allThreads.filter(t => t.isGroup);

          console.log(`ðŸ•’ ${now} â†’ ${groupThreads.length} à¦—à§à¦°à§à¦ªà§‡ à¦ªà¦¾à¦ à¦¾à¦¨à§‹ à¦¹à¦šà§à¦›à§‡...`);

          for (const thread of groupThreads) {
            await api.sendMessage(finalMessage, thread.threadID);
          }

          console.log("âœ… à¦¸à¦«à¦²à¦­à¦¾à¦¬à§‡ à¦¸à¦¬ à¦—à§à¦°à§à¦ªà§‡ à¦¬à¦¾à¦°à§à¦¤à¦¾ à¦ªà¦¾à¦ à¦¾à¦¨à§‹ à¦¹à§Ÿà§‡à¦›à§‡!");
        } catch (err) {
          console.error("âŒ AutoTimer Error:", err);
        }
      }
    };

    setInterval(checkTimeAndSend, 1000);
  }, 5000);
};

module.exports.onStart = () => {};
